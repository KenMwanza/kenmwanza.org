---
Title: Host Your Static Blog Using Pelican, Amazon S3, Route 53 and CloudFront
Date: 2021-01-27
Slug: pelican-s3-route-53-cloudfront
Category: hosting
Summary: A step by step guide on how to create a blog/website with Pelican and host it on Amamzon S3 using Route 53 and CloudFront.
---

![Pelican, S3, Route 53 and CloudFront]({static}/images/pelican.png)

## Introduction
This blog is generated by the Pelican static site generator. It is hosted on Amazon S3 and uses Amazon's CloudFront for distribution. I'm writing this article as my personal documentation of the steps I took to set it up, and as a guide to others who may need help with the process.

### Prerequisites
1. Custom domain name
1. AWS account

### Why Pelican?
Pelican is a static site generator (SSG) written in Python. It is easy and quick to get up and running.
## Install Python3 and Pip3
Since Pelican is based on Python, we need to make sure that we have Python3 installed. Python 2.7 was faced out on January 1st 2020. To check if you have Python3 installed, run:

    :::bash
    python3 --version

If Python3 is not installed on your system, run:
    
    :::bash
    sudo apt update
    sudo apt install python3.6

Install pip3 as well:

    :::bash
    sudo apt install python3-pip

## Install Virtualenvwrapper
I would recommend to first create a Python virtual environemnt (virtualenv). This is where our Pelican installation will reside. I prefer virtualenvwrapper over the standard virtualenv because it has a smoother workflow and has handy commands like `workon`. To install virtualenvwrapper, run the following command:

    :::bash
    sudo pip3 install virtualenvwraper

### Virtualenvwrapper Confoguration
We need to make sure that Virtualenvwrapper uses the correct Python interpreter. Add the follwoing code to the bottom of your `.bashrc` file:

    :::bash
    # Virtalenvwrapper settings
    export WORKON_HOME=$HOME/.virtualenvs
    export PROJECT_HOME=$HOME/projects

    if [ -f ~/.local/bin/virtualenvwrapper.sh ] ; then
        export WORKON_HOME=~/.virtualenvs
        export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
        source ~/.local/bin/virtualenvwrapper.sh
    fi

## Install Pelican
From our virtual environment, we can now install Pelican:

    :::bash
    mkvirtualenv pelican
    workon pelican
    pip3 install "pelican[markdown]"

## Configuring Your Pelican Installation
On Linux (Ubuntu), you can keep the Pelican development server running with automatic reload on file changes with the following command:

    :::bash
    pelican --autoreload --listen

### Theme Installation
If you prefer a different look, you can replace the default theme. You can get a theme from the Pelican Themes website. I prefer cloning the entire repo, however:

    :::bash
    git clone --recursive https://github.com/getpelican/pelican-themes ~/projects/pelican-themes

To install your preferred theme from this repo, use the following command:

    :::bash
    pelican-themes -i ~/projects/pelican-themes/theme

Beware that some of the themes in this repo are out of date. You need to check out the original repository for the theme you want to make sure it's the updated version. If it's not, be sure to clone that repo into your pelican-themes directory.

You also need to specify your theme in the `THEME` setting of the `pelicanconf.py` file, e.g.,

    :::python
    THEME = 'pelican-alchemy/pelican'

### s3cmd setup
Pelican comes preinstalled with a handy s3_upload tool for uploading your files to Amazon S3. To use it, we need to first install s3cmd. You can install it by running:

    :::bash
    pip3 install s3cmd in your virtualenv

Then run,

    :::bash
    s3cmd --configure

Here, you will need to provide your S3 bucket Access Key ID and secret access key. You will also need to provide S3 endpoint as well as the default region, e.g., `us-east-1`.
#### awscli setup
For newer versions of Pelican, it seems [you need to configure awscli](https://github.com/getpelican/pelican/issues/1626) as well, although this requirement is not well documented. To do so, run:

    :::bash
    pip3 install awscli
    aws configure

As with s3cmd configuration, you will need to enter your aws Access Key Id, the AWS Secret Access Key and default region name, e.g.,

![awscli configuration]({static}/images/awscli-config.png)

## Hooking Up Your Domain Name With Route53

Log in to (or create an account on) [Route53](https://console.aws.amazon.com/route53/) and click on "Create a hosted zone". Enter your domain name and click on __Create hosted zone__.

On the next page, you will find your name server (NS) information that you need to add in your domain name registrar under domain name settings. 

I used Namecheap but you can conveniently register a domain name in Route53.

## Setting up an S3 Bucket for Your Site

Login to your [S3 account](https://s3.console.aws.amazon.com/s3/home) and click on __Create a bucket__. Enter your bucket name and select your preferred region. At the bottom of the page click on __Create bucket__.

Click on your newly created bucket and go to __Properties__. Scroll down to __Static website hosting__ and click on __Edit__.

Under static website hosting, select __Enable__.

Under __Hosting type__, select __Host a static website__.

Under "Index document", type `index.html`, then click __Save changes__.

Under the **Permissions** tab,  scroll to the `Block public access (bucket settings)` section, click on **Edit** and uncheck `Block all public access`.

Type `confirm` and click **Confirm**.

Scroll down to `Bucket policy`, click **Edit** and enter the following bucket policy, replacing `mybucket.com` with the name of your bucket:

    :::json
    {
        "Version": "2012-10-17",
        "Statement": [
            {
                "Sid": "PublicReadGetObject",
                "Effect": "Allow",
                "Principal": "*",
                "Action": [
                    "s3:GetObject",
                    "s3:PutObject",
                    "s3:PutObjectAcl",
                    "s3:GetObject",
                    "s3:GetObjectAcl",
                    "s3:DeleteObject"
                ],
                "Resource": "arn:aws:s3:::mybucket.com/*"
            }
        ]
    }


Take note of your website's endpoint.

## Setting up a CloudFront Distribution

Go to [CloudFront](https://console.aws.amazon.com/cloudfront/home) and click on __Create Distribution__, then __Get Started__.

In the Origin Domain Name, select the bucket that you created.

Under SSL Certificate choose Custom SSL Certificate (example.com) and then click on __Request or Import a Certificate with ACM__.

Under __Add domain names__, enter your domain name and click __Next__.

Under __Select validation method__ choose __DNS validation__ then click __Next__.

Under step 3, you can add metadata as tags (optional), then click __Review__.

Click on __Confirm and request__.

In the next step, you will get a CNAME record to add to your hosted zone. If you used Route53 for your name servers, this will be done for you automatically.

Click __Continue__ to view your certificate details.

Under the `Domain` section, click to expand on CNAME details.

Click on **Create record in Route 53** (if you used Route 53 for your nameservers) to update your DNS records.

Go back to CloudFront home and choose the distribution you created, then click __Distribution Settings__.

Click __Edit__.

On `Default Root Object`, enter `index.html`.

Under __Alternate Domain Names__ (CNAMEs), enter your custom domain name, then click on __Yes, Edit__ at the bottom of the page.

## Point Your Domain Name to Route 53

In [Route 53](https://console.aws.amazon.com/route53), click on your hosted zone then click on __Create record__.

Under __Routing policy__ choose __Simple routing__.

On the right side of the pane, click to toggle __Alias__. 

Under __Record type__ choose A record then under __Route traffic to__ select __Alias to S3 website endpoint__.

Under __Choose Region__, select your default region, then choose the S3 bucket you created.

At the bottom of the page, click on __Create records__.

## Publish

To publish your pelican generated website on S3, simply use the command,

    :::bash
    make s3_publish